# دليل اختبار نظام طوابير الأطباء الجديد

## 🎯 النظام الجديد المطبق:

### **المميزات الجديدة:**
- ✅ **طوابير منفصلة لكل طبيب**
- ✅ **أرقام طابور منفصلة لكل طبيب**
- ✅ **إدارة مستقلة لكل طابور**
- ✅ **إحصائيات منفصلة لكل طابور**
- ✅ **تحديث مباشر لجميع الطوابير**

---

## 🗄️ **التحديثات في قاعدة البيانات:**

### **1. Migration جديد:**
```
supabase/migrations/20250120100000_implement_doctor_separate_queues.sql
```

### **2. الدوال الجديدة:**
- `get_next_doctor_queue_number()` - الحصول على الرقم التالي لطابور طبيب معين
- `get_current_doctor_queue_number()` - الحصول على الرقم الحالي لطابور طبيب معين
- `get_doctor_queue_stats()` - إحصائيات شاملة لطابور طبيب
- `get_medical_center_doctor_queues()` - جميع طوابير الأطباء في المركز
- `get_doctor_queue_patients()` - مرضى طابور طبيب معين

### **3. View جديد:**
- `doctor_queues_with_details` - عرض طوابير الأطباء مع التفاصيل

---

## 🎨 **التحديثات في الواجهة:**

### **1. Hook جديد:**
```
src/hooks/useDoctorQueues.ts
```

### **2. واجهة جديدة في لوحة التحكم:**
- **عرض طوابير منفصلة** لكل طبيب
- **إحصائيات منفصلة** لكل طابور
- **إدارة مستقلة** لكل طابور
- **أزرار منفصلة** (التالي، تأجيل، انتهى)

---

## 🧪 **خطوات الاختبار:**

### **الخطوة 1: تشغيل Migration**
```bash
# في Supabase Dashboard، قم بتشغيل:
supabase/migrations/20250120100000_implement_doctor_separate_queues.sql
```

### **الخطوة 2: اختبار الدوال**
```sql
-- اختبار الحصول على طوابير الأطباء
SELECT * FROM public.get_medical_center_doctor_queues('YOUR_MEDICAL_CENTER_ID');

-- اختبار الحصول على مرضى طابور طبيب معين
SELECT * FROM public.get_doctor_queue_patients('YOUR_MEDICAL_CENTER_ID', 'YOUR_DOCTOR_ID');
```

### **الخطوة 3: اختبار الواجهة**
1. **اذهب إلى لوحة تحكم المركز**
2. **انتقل إلى تبويب "الطوابير"**
3. **ستجد طوابير منفصلة لكل طبيب**
4. **انقر على طابور طبيب لرؤية التفاصيل**
5. **اختبر الأزرار (التالي، تأجيل، انتهى)**

---

## 📱 **الواجهة الجديدة:**

### **قبل التحديث:**
```
طابور واحد موحد:
├── مريض 1 - د. أحمد (طب بيطري)
├── مريض 2 - د. الدوسقي (عيون)
├── مريض 3 - د. أحمد (طب بيطري)
└── مريض 4 - د. الدوسقي (عيون)
```

### **بعد التحديث:**
```
طابور د. أحمد حمدي (طب بيطري):
├── مريض 1
├── مريض 2
└── [التالي] [تأجيل]

طابور د. الدوسقي (عيون):
├── مريض 1
├── مريض 2
└── [التالي] [تأجيل]
```

---

## 🔧 **المميزات الجديدة:**

### **✅ للمركز:**
- **إدارة منفصلة** لكل طبيب
- **طوابير منظمة** وواضحة
- **إحصائيات دقيقة** لكل طابور
- **مرونة في الإدارة**

### **✅ للأطباء:**
- **طابور خاص** لكل طبيب
- **أرقام منفصلة** (1، 2، 3...)
- **إدارة مستقلة** للطابور
- **وضوح في التنظيم**

### **✅ للمرضى:**
- **وضوح أكبر** في الانتظار
- **معرفة دقيقة** لموعد الدور
- **تنظيم أفضل** للطوابير
- **انتظار أقل** (كل طبيب له طابوره)

---

## 🚀 **كيفية الاستخدام:**

### **1. عرض الطوابير:**
- **انقر على طابور طبيب** لرؤية التفاصيل
- **ستظهر قائمة المرضى** في هذا الطابور
- **ستظهر الإحصائيات** (منتظرين، مكتملين)

### **2. إدارة الطابور:**
- **زر "استدعاء"** - لاستدعاء المريض التالي
- **زر "انتهى"** - لإنهاء فحص المريض الحالي
- **زر "تأجيل"** - لتأجيل المريض (لم يحضر)

### **3. عرض التفاصيل:**
- **زر "تفاصيل"** - لعرض تفاصيل المريض
- **معلومات كاملة** عن المريض والخدمة

---

## ⚠️ **ملاحظات مهمة:**

### **1. التوافق مع النظام القديم:**
- **النظام القديم لا يزال يعمل** (للتوافق)
- **النظام الجديد يعمل بالتوازي**
- **يمكن الانتقال تدريجياً**

### **2. البيانات الموجودة:**
- **سيتم تحديث البيانات الموجودة** تلقائياً
- **سيتم ربط الحجوزات بالأطباء** تلقائياً
- **لا توجد خسارة في البيانات**

### **3. الأداء:**
- **فهرسة محسنة** للبحث السريع
- **استعلامات محسنة** للأداء
- **تحديث مباشر** فعال

---

## 🎉 **النتيجة النهائية:**

النظام الجديد يوفر:
- **تنظيم أفضل** للطوابير
- **إدارة أسهل** للمراكز
- **تجربة أفضل** للمرضى
- **كفاءة أعلى** في العمل

**النظام جاهز للاختبار!** 🚀
