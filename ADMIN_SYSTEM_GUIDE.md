# دليل نظام الإدارة - إنشاء المراكز الطبية

## 🎯 نظرة عامة على النظام

### **المستخدم المدير:**
- **ID:** `130f849a-d894-4ce6-a78e-0df3812093de`
- **الدور:** Admin (مدير النظام)
- **الصلاحيات:** إنشاء وإدارة المراكز الطبية

### **عملية إنشاء المركز الطبي:**
1. **تسجيل دخول المدير** إلى لوحة الإدارة
2. **إنشاء مركز طبي جديد** بجميع التفاصيل
3. **توليد رقم تسلسلي** تلقائياً للمركز
4. **إعطاء الرقم التسلسلي** للمركز الطبي
5. **تسجيل دخول المركز** باستخدام الرقم التسلسلي

## 🔧 خطوات الإعداد

### **الخطوة 1: تشغيل Migrations**
```sql
-- في Supabase Dashboard، قم بتشغيل:
1. supabase/migrations/20250120000002_fix_user_roles_policies.sql
2. supabase/migrations/20250120000003_add_admin_user.sql
```

### **الخطوة 2: التحقق من البيانات**
```sql
-- تحقق من وجود المستخدم كـ admin
SELECT * FROM public.user_roles WHERE user_id = '130f849a-d894-4ce6-a78e-0df3812093de';

-- تحقق من وجود المستخدم في auth.users
SELECT * FROM auth.users WHERE id = '130f849a-d894-4ce6-a78e-0df3812093de';
```

## 🚀 كيفية استخدام النظام

### **1. تسجيل دخول المدير:**
1. **اذهب إلى** `http://localhost:8082/`
2. **تسجيل دخول** بالمستخدم المحدد
3. **اذهب إلى تبويب "حسابي"**
4. **انقر على "لوحة تحكم الإدارة"**

### **2. إنشاء مركز طبي جديد:**
1. **انقر على "إضافة مركز طبي"**
2. **املأ البيانات المطلوبة:**
   - اسم المركز الطبي
   - التخصص
   - العنوان
   - رقم الهاتف
   - البريد الإلكتروني
   - ساعات العمل
   - الوصف
   - بريد إداري المركز (اختياري)
   - كلمة مرور إدارية (اختياري)

3. **انقر على "إنشاء المركز"**
4. **سيتم توليد رقم تسلسلي تلقائياً**

### **3. إعطاء الرقم التسلسلي للمركز:**
- **الرقم التسلسلي** يظهر في قائمة المراكز
- **أعطِ هذا الرقم** للمركز الطبي
- **يمكن للمركز استخدامه** لتسجيل الدخول

## 📋 تفاصيل النظام

### **جدول medical_centers:**
```sql
CREATE TABLE public.medical_centers (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  specialty TEXT NOT NULL,
  address TEXT NOT NULL,
  phone TEXT NOT NULL,
  email TEXT,
  hours TEXT,
  description TEXT,
  image_url TEXT,
  rating NUMERIC DEFAULT 0,
  status TEXT DEFAULT 'active',
  serial_number TEXT NOT NULL UNIQUE, -- الرقم التسلسلي
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now() NOT NULL
);
```

### **توليد الرقم التسلسلي:**
```typescript
// في useAdminCenters hook
const generateSerialNumber = () => {
  const timestamp = Date.now().toString(36);
  const random = Math.random().toString(36).substr(2, 5);
  return `SN${timestamp}${random}`.toUpperCase();
};
```

## 🔐 نظام تسجيل دخول المراكز

### **للمراكز الطبية:**
1. **اذهب إلى** `/clinic/auth`
2. **اختر "تسجيل دخول"**
3. **أدخل الرقم التسلسلي** في حقل "الرقم التسلسلي"
4. **أدخل كلمة المرور** (إذا تم تعيينها)
5. **انقر على "تسجيل الدخول"**

### **إنشاء حساب جديد للمركز:**
1. **اذهب إلى** `/clinic/auth`
2. **اختر "تسجيل مركز جديد"**
3. **املأ البيانات المطلوبة**
4. **أدخل الرقم التسلسلي** المخصص للمركز
5. **انقر على "تسجيل المركز"**

## 🎛️ لوحة تحكم الإدارة

### **الوظائف المتاحة:**
- ✅ **عرض جميع المراكز** الطبية
- ✅ **إضافة مركز طبي جديد**
- ✅ **تعديل بيانات المركز**
- ✅ **تفعيل/إلغاء تفعيل المركز**
- ✅ **حذف المركز نهائياً**
- ✅ **البحث في المراكز**
- ✅ **عرض إحصائيات المركز**

### **معلومات المركز المعروضة:**
- اسم المركز والتخصص
- العنوان ورقم الهاتف
- البريد الإلكتروني
- ساعات العمل
- عدد الأطباء والخدمات
- التقييم المتوسط
- الحالة (نشط/غير نشط)
- **الرقم التسلسلي**

## 🔄 تدفق العمل

### **1. إنشاء المركز:**
```
المدير → لوحة الإدارة → إضافة مركز → ملء البيانات → إنشاء → توليد رقم تسلسلي
```

### **2. تسجيل دخول المركز:**
```
المركز → صفحة تسجيل الدخول → إدخال الرقم التسلسلي → تسجيل الدخول → لوحة تحكم المركز
```

### **3. إدارة المركز:**
```
المركز → لوحة التحكم → إدارة الأطباء → إدارة الخدمات → إدارة الحجوزات
```

## 🛠️ استكشاف الأخطاء

### **إذا لم تظهر لوحة الإدارة:**
1. **تحقق من تسجيل الدخول** بالمستخدم المحدد
2. **تحقق من Console** للرسائل
3. **تأكد من تشغيل Migrations**
4. **تحقق من وجود المستخدم** في user_roles

### **إذا لم يتم توليد الرقم التسلسلي:**
1. **تحقق من useAdminCenters hook**
2. **تحقق من دالة generateSerialNumber**
3. **تحقق من إدراج البيانات** في قاعدة البيانات

### **إذا لم يتمكن المركز من تسجيل الدخول:**
1. **تحقق من صحة الرقم التسلسلي**
2. **تحقق من وجود المركز** في قاعدة البيانات
3. **تحقق من حالة المركز** (نشط/غير نشط)

## 📊 إحصائيات النظام

### **المراكز الطبية:**
- **إجمالي المراكز:** عدد المراكز المسجلة
- **المراكز النشطة:** عدد المراكز المفعلة
- **المراكز غير النشطة:** عدد المراكز المعطلة

### **الخدمات:**
- **إجمالي الخدمات:** عدد الخدمات المتاحة
- **متوسط الأسعار:** متوسط أسعار الخدمات
- **التخصصات:** قائمة التخصصات المتاحة

## 🎯 النتيجة النهائية

### **للمدير:**
- ✅ **إنشاء وإدارة المراكز** الطبية
- ✅ **توليد أرقام تسلسلية** تلقائياً
- ✅ **مراقبة حالة المراكز**
- ✅ **إحصائيات شاملة**

### **للمراكز الطبية:**
- ✅ **تسجيل دخول آمن** بالرقم التسلسلي
- ✅ **إدارة تفاصيل المركز**
- ✅ **إدارة الأطباء والخدمات**
- ✅ **متابعة الحجوزات**

النظام جاهز للاستخدام! 🚀
