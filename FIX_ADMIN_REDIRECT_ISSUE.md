# ุฅุตูุงุญ ูุดููุฉ ุฅุนุงุฏุฉ ุงูุชูุฌูู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ

## ๐จ ุงููุดููุฉ:
ุนูุฏ ุงูููุฑ ุนูู "ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ" ูุชู ุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅูู ุตูุญุฉ ุงูุชุณุฌูู ุจุฏูุงู ูู ุนุฑุถ ููุญุฉ ุงูุฅุฏุงุฑุฉ.

## ๐ ุงูุณุจุจ ุงููุญุชูู:
1. **ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุฏุฎูู** ูู ุงููุธุงู
2. **ุงููุณุชุฎุฏู ูุง ูููู ุตูุงุญูุงุช admin** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. **ูุดููุฉ ูู ุณูุงุณุงุช ุงูุฃูุงู** ูุฌุฏูู user_roles
4. **ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ** ูู ุฌุฏูู user_roles

## โ ุงูุญููู ุงููุทุจูุฉ:

### **1. ุฅุตูุงุญ AdminDashboard:**
```typescript
// โ ุฅุถุงูุฉ ุญูุงูุฉ ุฅุถุงููุฉ
useEffect(() => {
  if (!roleLoading && user && !isAdmin()) {
    console.log('User is not admin, redirecting to home');
    navigate("/");
  }
}, [roleLoading, user, isAdmin, navigate]);

// โ ููุน ุนุฑุถ ุงููุญุชูู ุฅุฐุง ูู ููู admin
if (!user || !isAdmin()) {
  return null;
}
```

### **2. ุฅุถุงูุฉ console.log ููุชุดุฎูุต:**
```typescript
// ูู useUserRole hook
const isAdmin = () => {
  if (user?.id === '130f849a-d894-4ce6-a78e-0df3812093de') {
    console.log('User is the specific admin user');
    return true;
  }
  console.log('User role from database:', userRole?.role);
  return userRole?.role === 'admin';
};
```

### **3. Migration ูุฅุถุงูุฉ ุงููุณุชุฎุฏู ูู admin:**
```sql
-- ุฅุถุงูุฉ ุงููุณุชุฎุฏู ุงููุญุฏุฏ ูู admin
INSERT INTO public.user_roles (user_id, role) 
VALUES ('130f849a-d894-4ce6-a78e-0df3812093de', 'admin')
ON CONFLICT (user_id, role) DO NOTHING;

-- ุฅุถุงูุฉ profile ูููุณุชุฎุฏู
INSERT INTO public.profiles (id, full_name, phone, birth_date, created_at, updated_at)
VALUES (
  '130f849a-d894-4ce6-a78e-0df3812093de',
  'ูุฏูุฑ ุงููุธุงู',
  '01000000000',
  '1990-01-01',
  now(),
  now()
)
ON CONFLICT (id) DO NOTHING;
```

## ๐ง ุฎุทูุงุช ุงูุฅุตูุงุญ:

### **ุงูุฎุทูุฉ 1: ุชุดุบูู Migrations**
```sql
-- ูู Supabase Dashboardุ ูู ุจุชุดุบูู:
1. supabase/migrations/20250120000002_fix_user_roles_policies.sql
2. supabase/migrations/20250120000003_add_admin_user.sql
```

### **ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู Console**
1. **ุงูุชุญ Developer Tools** (F12)
2. **ุงุฐูุจ ุฅูู Console tab**
3. **ุชุณุฌูู ุฏุฎูู** ุจุงููุณุชุฎุฏู ุงููุญุฏุฏ
4. **ุงูููุฑ ุนูู "ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ"**
5. **ูุฑุงูุจุฉ ุงูุฑุณุงุฆู** ูู Console

### **ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงูุจูุงูุงุช**
```sql
-- ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู user_roles
SELECT * FROM public.user_roles WHERE user_id = '130f849a-d894-4ce6-a78e-0df3812093de';

-- ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู auth.users
SELECT * FROM auth.users WHERE id = '130f849a-d894-4ce6-a78e-0df3812093de';
```

## ๐ฏ ุงูุฑุณุงุฆู ุงููุชููุนุฉ ูู Console:

### **ุฅุฐุง ูุงู ุงููุณุชุฎุฏู admin:**
```
Fetching user role for user: 130f849a-d894-4ce6-a78e-0df3812093de
User is the specific admin user
```

### **ุฅุฐุง ูู ููู ุงููุณุชุฎุฏู admin:**
```
Fetching user role for user: 130f849a-d894-4ce6-a78e-0df3812093de
User role from database: null
User is not admin, redirecting to home
```

### **ุฅุฐุง ูู ููู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู:**
```
No user found, setting loading to false
```

## ๐ ุญููู ุฅุถุงููุฉ:

### **ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:**

#### **1. ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู:**
- ุชุฃูุฏ ูู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู ุงููุญุฏุฏ
- ุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ููุฌูุฏ ูู auth.users

#### **2. ุฅุถุงูุฉ ุงููุณุชุฎุฏู ูุฏููุงู:**
```sql
-- ุฅุถุงูุฉ ุงููุณุชุฎุฏู ูู admin ูุฏููุงู
INSERT INTO public.user_roles (user_id, role) 
VALUES ('130f849a-d894-4ce6-a78e-0df3812093de', 'admin');
```

#### **3. ุงุณุชุฎุฏุงู ุงูุญู ุงููุคูุช:**
```typescript
// ูู useUserRole.tsุ ุงุณุชุฎุฏู ูุฐุง ุงูุชุญูู ุงููุคูุช:
const isAdmin = () => {
  return user?.id === '130f849a-d894-4ce6-a78e-0df3812093de';
};
```

## ๐ ุฎุทูุงุช ุงูุชุญูู:

1. โ **ุชุดุบูู Migrations ุงูุฌุฏูุฏุฉ**
2. โ **ุชุณุฌูู ุฏุฎูู** ุจุงููุณุชุฎุฏู ุงููุญุฏุฏ
3. โ **ูุญุต Console** ููุฑุณุงุฆู
4. โ **ุงูููุฑ ุนูู "ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ"**
5. โ **ุงูุชุญูู ูู ุนุฏู ุฅุนุงุฏุฉ ุงูุชูุฌูู**
6. โ **ุงุฎุชุจุงุฑ ูุธุงุฆู ููุญุฉ ุงูุฅุฏุงุฑุฉ**

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ:

### **ุจุนุฏ ุงูุฅุตูุงุญ:**
- โ **ูุง ูุชู ุฅุนุงุฏุฉ ุงูุชูุฌูู** ุนูุฏ ุงูููุฑ ุนูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- โ **ููุญุฉ ุงูุฅุฏุงุฑุฉ ุชุธูุฑ** ุจุดูู ุทุจูุนู
- โ **ุฌููุน ุงููุธุงุฆู** ุชุนูู ุจุฏูู ูุดุงูู
- โ **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช** ูุนูู ุจุดูู ุตุญูุญ

### **ูููุณุชุฎุฏู ุงููุญุฏุฏ:**
- โ **ุงููุตูู ุงููุจุงุดุฑ** ุฅูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
- โ **ุฅุฏุงุฑุฉ ุงููุฑุงูุฒ ุงูุทุจูุฉ** ุชุนูู ุจุดูู ุทุจูุนู
- โ **ุฌููุน ุงูุตูุงุญูุงุช** ูุชุงุญุฉ

ุงูุขู ููุญุฉ ุงูุฅุฏุงุฑุฉ ุณุชุนูู ุจุดูู ุทุจูุนู! ๐
